<!DOCTYPE html>
<html>
    <head>
        <title>Loss</title>
        <script src="https://unpkg.com/jspsych@7.3.4"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.3"></script>
        <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
    </head>
    <body></body>
    <script>
                
        // Initialize jsPsych
        var jsPsych = initJsPsych({
            on_finish: function() {
              jsPsych.data.displayData();
            }
          });
        var timeline = []; // Create the timeline

        /** ---------------------  1. Task  ------------------------------ */
        const option_c_neutral = 'I can\'t decide.';
        const prompt_followup = 'Please choose between these two options';

        // ==================== Question 1: Asian Disease ====================
        const prompt_asian_disease = `
            <p style="text-align: left;">Recently, a dangerous new disease has been going around. 
            Without medicine, 600,000 people will die from it. </p>
            <p style="text-align: left;">In order to save these people, 
            two types of medicine are being made.</p>
            <p style="text-align: left;">Now you have to choose, which one to use.</p>
        `;
        const option_a_asian_disease = '200,000 people will be saved.';
        const option_b_asian_disease = 'There is a 33.3% chance that 600,000 people will be saved and a 66.6% chance that no one will be saved.';
        
        // Main question
        var asian_disease = {
            type: jsPsychSurveyMultiChoice,
            questions: [
                {
                    prompt: prompt_asian_disease, 
                    name: 'AsianDisease', 
                    options: [option_a_asian_disease, option_b_asian_disease, option_c_neutral], 
                    required: true
                }
            ],
        };

        // Follow-up question 
        var followup_asian_disease = {
            type: jsPsychSurveyMultiChoice,
            questions: [
                {
                    prompt: prompt_followup, 
                    name: 'AsianDiseaseFollowup', 
                    options: [option_a_asian_disease, option_b_asian_disease],  // Only A and B options
                    required: true
                }
            ],
            conditional_function: function() {
                // Get the last trial data
                var last_trial_data = jsPsych.data.get().last(1).values()[0];
        
                // Debugging: Log the last trial data
                console.log('Last trial data:', last_trial_data);
        
                // Extract the response using the name 'AsianDisease'
                var response = last_trial_data.response['AsianDisease'];
        
                // Debugging: Log the response value
                console.log('Selected response:', response);
        
                // Check if the response equals the neutral option
                return response === option_c_neutral;
            }
        };

        // Add both trials to the timeline
        timeline.push(asian_disease);          // First question with A, B, C
        timeline.push(followup_asian_disease); // Follow-up question if C is chosen


        // ==================== Question 3: Damaged_Painting ====================
        const prompt_damaged_painting = `
            <p style="text-align: left;">A large museum is damaged by fire. 
            1,000 famous paintings are at the risk of being destroyed.</p>
            <p style="text-align: left;">Two alternative programs have been proposed to restore the paintings.</p>
            <p style="text-align: left;">Now you have to choose which one to follow, 
            or you may indicate if you are unsure.</p>
        `;
        const option_a_damaged_painting = '400 paintings will be saved.';
        const option_b_damaged_painting = 'There is a 33.3% chance that no jobs will be lost and a 66.6% chance that all 300,000 jobs will be lost.';

        // Main question
        var damaged_painting = {
            type: jsPsychSurveyMultiChoice,
            questions: [
                {
                    prompt: prompt_damaged_painting, 
                    name: 'DamagedPainting', 
                    options: [option_a_damaged_painting, option_b_damaged_painting, option_c_neutral], 
                    required: true
                }
            ],
        };

        // Follow-up question 
        var followup_damaged_painting = {
            type: jsPsychSurveyMultiChoice,
            questions: [
                {
                    prompt: prompt_followup, 
                    name: 'DamagedPaintingFollowup', 
                    options: [option_a_damaged_painting, option_b_damaged_painting],  
                    required: true
                }
            ],
            conditional_function: function() {
                var last_trial_data = jsPsych.data.get().last(1).values()[0];
                return last_trial_data.response['Q0'] === 2; 
            }
        };

        timeline.push(damaged_painting);          
        timeline.push(followup_damaged_painting); 

        // ==================== Question 4: Computer Virus ====================
        const prompt_computer_virus = `
            <p style="text-align: left;">There is a new computer virus which can infect certain computer software. 
            At the moment, this software is installed on 2 000 000 computers.</p>
            <p style="text-align: left;">Two types of antivirus software are being developed.</p>
            <p style="text-align: left;">Now you have to choose which one to use, 
            or you may indicate if you are unsure.</p>
        `;
        const option_a_computer_virus = '1,200,000 computers will be infected.';
        const option_b_computer_virus = 'There is a 40% chance that no computer will be infected and a 60% chance that 2,000,000 computers will be infected.';

        // Main question
        var computer_virus = {
            type: jsPsychSurveyMultiChoice,
            questions: [
                {
                    prompt: prompt_computer_virus, 
                    name: 'ComputerVirus', 
                    options: [option_a_computer_virus, option_b_computer_virus, option_c_neutral], 
                    required: true
                }
            ],
        };

        // Follow-up question 
        var followup_computer_virus = {
            type: jsPsychSurveyMultiChoice,
            questions: [
                {
                    prompt: prompt_followup, 
                    name: 'ComputerVirusFollowup', 
                    options: [option_a_computer_virus, option_b_computer_virus],
                    required: true
                }
            ],
            conditional_function: function() {
                var last_trial_data = jsPsych.data.get().last(1).values()[0];
                return last_trial_data.response['Q0'] === 2; 
            }
        };

        timeline.push(computer_virus);          
        timeline.push(followup_computer_virus); 
        
         /** ---------------------  2. Survey ------------------------------ */

        timeline.push({
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `
            Thank you for participating! You will now complete a survey.
            <br><br>
            Press any key to proceed to the survey.
            `,
        });

        // Define Likert scale
        var likert_scale = [
            "1<br>Strongly Disagree", 
            "2", 
            "3", 
            "4", 
            "5<br>Strongly Agree"
        ];

        // Define the survey trials
        var survey_trial = {
            type: jsPsychSurveyLikert,
            questions: [
                {prompt: "I think the question doesn’t matter to me.", name: 'Indifference', labels: likert_scale},
                {prompt: "I feel it’s not my responsibility to make a choice in this situation.", name: 'Responsibility', labels: likert_scale},
                {prompt: "I think I would need more information to decide..", name: 'InformationSeeking', labels: likert_scale},
                ],
        };

        timeline.push(survey_trial)

        // Start the experiment
        jsPsych.run(timeline);

    </script>
</html>
