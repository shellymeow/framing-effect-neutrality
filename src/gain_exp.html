<!DOCTYPE html>
<html>
    <head>
        <title>Gain</title>
        <script src="https://unpkg.com/jspsych@7.3.4"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.3"></script>
        <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
    </head>
    <body></body>
    <script>
                
        // Initialize jsPsych
        var jsPsych = initJsPsych({
            on_finish: function() {
              jsPsych.data.displayData();
            }
          });
        var timeline = []; // Create the timeline

        /** ---------------------  Task Setup  ------------------------------ */
        const option_c_neutral = 'I would like to flip a coin';
        const prompt_followup = 'Please choose between these two options';

        // ==================== Question 1: Asian Disease ====================
        const prompt_asian_disease = `
            <p style="text-align: left;">Recently, a dangerous new disease has been going around. 
            Without medicine, 600,000 people will die from it.</p>
            <p style="text-align: left;">In order to save these people, 
            two types of medicine are being made.</p>
            <p style="text-align: left;">Now you have to choose which one to use.</p>
        `;
        const option_a_asian_disease = '<b>200,000</b> people will be <b>saved</b>.';
        const option_b_asian_disease = 'There is a <b>33.3% chance</b> that <b>600,000</b> people will be <b>saved</b> and a <b>66.6% chance</b> that <b>no one</b> will be <b>saved</b>.';

        // Main question
        var asian_disease = {
            type: jsPsychSurveyMultiChoice,
            questions: [
                {
                    prompt: prompt_asian_disease, 
                    name: 'AsianDisease', 
                    options: [option_a_asian_disease, option_b_asian_disease, option_c_neutral], 
                    required: true
                }
            ],
        };

        // Function to create feedback prompts
        function create_feedback_prompt_disease(selectedOption) {
            return {
                type: jsPsychSurveyMultiChoice,
                questions: [
                    {
                        prompt: `<p>You chose:</p>
                            <p>${selectedOption}</p>
                            <p>Do you want to <b>change</b> your decision?</p>`, 
                        name: 'FeedbackAsianDisease', 
                        options: ['Yes', 'No'], 
                        required: true
                    }
                ]
            };
        }

        // Function to add conditional feedback based on selected option
        function add_conditional_feedback_disease(optionText, feedbackPrompt) {
            return {
                timeline: [feedbackPrompt],
                conditional_function: function() {
                    var last_response = jsPsych.data.get().last(1).values()[0].response.AsianDisease;
                    return last_response === optionText;
                }
            };
        }

        // Define feedback prompts
        var feedback_prompt_a_disease = create_feedback_prompt_disease(option_a_asian_disease);
        var feedback_prompt_b_disease = create_feedback_prompt_disease(option_b_asian_disease);

        // Define conditional feedback
        var conditional_feedback_a_disease = add_conditional_feedback_disease(option_a_asian_disease, feedback_prompt_a_disease);
        var conditional_feedback_b_disease = add_conditional_feedback_disease(option_b_asian_disease, feedback_prompt_b_disease);
        var conditional_feedback_c_disease = add_conditional_feedback_disease(option_c_neutral, feedback_prompt_b_disease);  // Uses option B feedback for option C

        // Add trials to the timeline
        timeline.push(asian_disease);           // Main question
        timeline.push(conditional_feedback_a_disease);   // Feedback for Option A
        timeline.push(conditional_feedback_b_disease);   // Feedback for Option B
        timeline.push(conditional_feedback_c_disease);   // Feedback for Option C

        // ==================== Question 3: Damaged_Painting ====================
        const prompt_damaged_painting = `
            <p style="text-align: left;">A large museum is damaged by fire. 
            1,000 famous paintings are at the risk of being destroyed.</p>
            <p style="text-align: left;">Two alternative programs have been proposed to restore the paintings.</p>
            <p style="text-align: left;">Now you have to choose which one to follow, 
            or you may indicate if you are unsure.</p>
        `;
        const option_a_damaged_painting = '400 paintings will be saved.';
        const option_b_damaged_painting = 'There is a 33.3% chance that no jobs will be lost and a 66.6% chance that all 300,000 jobs will be lost.';

            // Main question
            var damaged_painting = {
                type: jsPsychSurveyMultiChoice,
                questions: [
                    {
                        prompt: prompt_damaged_painting, 
                        name: 'DamagedPainting', 
                        options: [option_a_damaged_painting, option_b_damaged_painting, option_c_neutral], 
                        required: true
                    }
                ],
            };
    
            // Function to create feedback prompts
            function create_feedback_prompt_painting(selectedOption) {
                return {
                    type: jsPsychSurveyMultiChoice,
                    questions: [
                        {
                            prompt: `<p>You chose:</p>
                                <p>${selectedOption}</p>
                                <p>Do you want to <b>change</b> your decision?</p>`, 
                            name: 'FeedbackDamagedPainting', 
                            options: ['Yes', 'No'], 
                            required: true
                        }
                    ]
                };
            }
    
            // Function to add conditional feedback based on selected option
            function add_conditional_feedback_painting(optionText, feedbackPrompt) {
                return {
                    timeline: [feedbackPrompt],
                    conditional_function: function() {
                        var last_response = jsPsych.data.get().last(1).values()[0].response.DamagedPainting;
                        return last_response === optionText;
                    }
                };
            }
    
            // Define feedback prompts
            var feedback_prompt_a_painting = create_feedback_prompt_painting(option_a_damaged_painting);
            var feedback_prompt_b_painting = create_feedback_prompt_painting(option_b_damaged_painting);
    
            // Define conditional feedback
            var conditional_feedback_a_painting = add_conditional_feedback_painting(option_a_damaged_painting, feedback_prompt_a_painting);
            var conditional_feedback_b_painting = add_conditional_feedback_painting(option_b_damaged_painting, feedback_prompt_b_painting);
            var conditional_feedback_c_painting = add_conditional_feedback_painting(option_c_neutral, feedback_prompt_b_painting);  // Uses option B feedback for option C
    
            // Add trials to the timeline
            timeline.push(damaged_painting);           // Main question
            timeline.push(conditional_feedback_a_painting);   // Feedback for Option A
            timeline.push(conditional_feedback_b_painting);   // Feedback for Option B
            timeline.push(conditional_feedback_c_painting);   // Feedback for Option C

        // ==================== Question 4: Computer Virus ====================
        const prompt_computer_virus = `
            <p style="text-align: left;">There is a new computer virus which can infect certain computer software. 
            At the moment, this software is installed on 2 000 000 computers.</p>
            <p style="text-align: left;">Two types of antivirus software are being developed.</p>
            <p style="text-align: left;">Now you have to choose which one to use, 
            or you may indicate if you are unsure.</p>
        `;
        const option_a_computer_virus = '1,200,000 computers will be infected.';
        const option_b_computer_virus = 'There is a 40% chance that no computer will be infected and a 60% chance that 2,000,000 computers will be infected.';

        // Main question
        var computer_virus = {
            type: jsPsychSurveyMultiChoice,
            questions: [
                {
                    prompt: prompt_computer_virus, 
                    name: 'ComputerVirus', 
                    options: [option_a_computer_virus, option_b_computer_virus, option_c_neutral], 
                    required: true
                }
            ],
        };

        // Function to create feedback prompts
        function create_feedback_prompt_virus(selectedOption) {
            return {
                type: jsPsychSurveyMultiChoice,
                questions: [
                    {
                        prompt: `<p>You chose:</p>
                            <p>${selectedOption}</p>
                            <p>Do you want to <b>change</b> your decision?</p>`, 
                        name: 'FeedbackDamagedvirus', 
                        options: ['Yes', 'No'], 
                        required: true
                    }
                ]
            };
        }

        // Function to add conditional feedback based on selected option
        function add_conditional_feedback_virus(optionText, feedbackPrompt) {
            return {
                timeline: [feedbackPrompt],
                conditional_function: function() {
                    var last_response = jsPsych.data.get().last(1).values()[0].response.ComputerVirus;
                    return last_response === optionText;
                }
            };
        }

        // Define feedback prompts
        var feedback_prompt_a_virus = create_feedback_prompt_virus(option_a_computer_virus);
        var feedback_prompt_b_virus = create_feedback_prompt_virus(option_b_computer_virus);

        // Define conditional feedback
        var conditional_feedback_a_virus = add_conditional_feedback_virus(option_a_computer_virus, feedback_prompt_a_virus);
        var conditional_feedback_b_virus = add_conditional_feedback_virus(option_b_computer_virus, feedback_prompt_b_virus);
        var conditional_feedback_c_virus = add_conditional_feedback_virus(option_c_neutral, feedback_prompt_b_virus);  // Uses option B feedback for option C

        // Add trials to the timeline
        timeline.push(computer_virus);           // Main question
        timeline.push(conditional_feedback_a_virus);   // Feedback for Option A
        timeline.push(conditional_feedback_b_virus);   // Feedback for Option B
        timeline.push(conditional_feedback_c_virus);   // Feedback for Option C
        
         /** ---------------------  2. Survey ------------------------------ */

        timeline.push({
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `
            Thank you for participating! You will now complete a survey.
            <br><br>
            Press any key to proceed to the survey.
            `,
        });

        // Define Likert scale
        var likert_scale = [
            "1<br>Strongly Disagree", 
            "2", 
            "3", 
            "4", 
            "5<br>Strongly Agree"
        ];

        // Define the survey trials
        var survey_trial = {
            type: jsPsychSurveyLikert,
            questions: [
                {prompt: "I think the question doesn’t matter to me.", name: 'Indifference', labels: likert_scale},
                {prompt: "I feel it’s not my responsibility to make a choice in this situation.", name: 'Responsibility', labels: likert_scale},
                {prompt: "I think I would need more information to decide..", name: 'InformationSeeking', labels: likert_scale},
                ],
        };

        timeline.push(survey_trial)

        // Start the experiment
        jsPsych.run(timeline);

    </script>
</html>
